apiVersion: kustomize.config.k8s.io/v1beta1
kind: Kustomization

resources:
  - ../../base

patches:
  # Update cluster-resources path for dev environment
  - target:
      kind: Application
      name: cluster-resources
    patch: |-
      - op: replace
        path: /spec/source/path
        value: k8s/cluster-resources/overlays/dev

  # Update cert-manager-resources path for dev environment
  - target:
      kind: Application
      name: cert-manager-resources
    patch: |-
      - op: replace
        path: /spec/source/path
        value: k8s/cert-manager/overlays/dev

  # Update external-secrets-resources path for dev environment
  - target:
      kind: Application
      name: external-secrets-resources
    patch: |-
      - op: replace
        path: /spec/source/path
        value: k8s/external-secrets/overlays/dev

  # livekit-server uses multi-source with valueFiles
  # Values are read from k8s/livekit-server/overlays/dev/values.yaml
  # No patch needed - just update the sources in base
  - target:
      kind: Application
      name: livekit-server
    patch: |-
      - op: replace
        path: /spec/sources/1/helm/valueFiles
        value:
          - $values/k8s/livekit-server/base/values.yaml
          - $values/k8s/livekit-server/overlays/dev/values.yaml
